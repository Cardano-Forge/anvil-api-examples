# ruby basic-tx.rb

require 'net/http'
require 'json'
require 'uri'

request_body = {
  changeAddress: "addr_test1qrydyk6uw6cehk5u3zspyz3dhnwzmhfls2fp42vv5dv9g2z3885pg4kpkn30ptezc855lu3w5ey93zcr5lrezjmwkftqg8xvge",
  outputs: [
    {
      address: "addr_test1qr0tkwvlln0v5fljdxceudmlpt5y6szc84vpj4skm836tgn4hsqaesgg97l8ppy5rsn0alj8pth6lqe20fdyydsdgw6sr74cyt",
      lovelace: 10_000_000
    }
  ]
}

uri = URI.parse("https://preprod.api.ada-anvil.app/v2/services/transactions/build")
http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = true

request = Net::HTTP::Post.new(uri.path)
request['Content-Type'] = 'application/json'
request['x-api-key'] = 'testnet_EyrkvCWDZqjkfLSe1pxaF0hXxUcByHEhHuXIBjt9'
request.body = JSON.generate(request_body)

response = http.request(request)
puts response.body

# {
# "hash":"f3270fe214a45453ee7fb7495a9592b2c4609ad9d46018fd13ec02c70ac2443b",
# "complete":"84a600d90102828258202bc2c20fa2cb1ed533dff232805f1b795f4e2d88105d847a96284abcf38c547903825820af82fa958d1fb2fd58e53a31cafb830fdae0c71bd150b839251dc8a754646e5501018382583900debb399ffcdeca27f269b19e377f0ae84d40583d58195616d9e3a5a275bc01dcc1082fbe7084941c26fefe470aefaf832a7a5a42360d43b51a00989680a300581d6039fd21b29d8a8832b16ea5bfc07b409bd0f68566accfb4b9c8a1389c011a00162010028201d8184a49616e76696c2d74616782583900c8d25b5c76b19bda9c88a0120a2dbcdc2ddd3f82921aa98ca35854285139e81456c1b4e2f0af22c1e94ff22ea648588b03a7c7914b6eb2561b000000018947f274021a00030961031a05f7c731081a05f7ab110ed9010281581c39fd21b29d8a8832b16ea5bfc07b409bd0f68566accfb4b9c8a1389ca100d9010281825820d02701da7521a07e07a63025a202dc9c27b4c7181515c6fa093559c9421db438584059b62c554b8c73b258d2d651b6d52f9e5d2179c0a33d2035b4e4721ddfc4c35bf9e4b6eb0ee701f6b67aa7ce2aa3714201731df9ffb7a9a63e327c6d1400be07f5f6",
# "stripped":"84a600d90102828258202bc2c20fa2cb1ed533dff232805f1b795f4e2d88105d847a96284abcf38c547903825820af82fa958d1fb2fd58e53a31cafb830fdae0c71bd150b839251dc8a754646e5501018382583900debb399ffcdeca27f269b19e377f0ae84d40583d58195616d9e3a5a275bc01dcc1082fbe7084941c26fefe470aefaf832a7a5a42360d43b51a00989680a300581d6039fd21b29d8a8832b16ea5bfc07b409bd0f68566accfb4b9c8a1389c011a00162010028201d8184a49616e76696c2d74616782583900c8d25b5c76b19bda9c88a0120a2dbcdc2ddd3f82921aa98ca35854285139e81456c1b4e2f0af22c1e94ff22ea648588b03a7c7914b6eb2561b000000018947f274021a00030961031a05f7c731081a05f7ab110ed9010281581c39fd21b29d8a8832b16ea5bfc07b409bd0f68566accfb4b9c8a1389ca0f5f6",
# "witnessSet":"a100d9010281825820d02701da7521a07e07a63025a202dc9c27b4c7181515c6fa093559c9421db438584059b62c554b8c73b258d2d651b6d52f9e5d2179c0a33d2035b4e4721ddfc4c35bf9e4b6eb0ee701f6b67aa7ce2aa3714201731df9ffb7a9a63e327c6d1400be07"
# }