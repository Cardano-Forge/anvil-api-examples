// API endpoint for Wayup Marketplace
const NFT_BASE_URL = "https://prod.api.ada-anvil.app/marketplace/api";

// NFT Collection and asset to bid on
const NFT_POLICY_ID = "6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01";
const NFT_ASSET_NAME_HEX = "4646506f776572436f726573373338";

// Wallet address to receive change
const BIDDER_CHANGE_ADDRESS = "addr1qx33ycd2ymg02dxh6vnnf8dsk54l8ranr9cfjk9qrlj3309c69jc4n8h3uvnczncaqu2sm03pl99h99n75uvtl3mhv0q3z8s8m";

// UTXOs from your wallet to fund the transaction
const BIDDER_UTXOS: string[] = [
  "82825820fa7a8f907051db7783be036684481fdce2a5fbcf19f6e5ea5f9f09128288dd1f0382583901a31261aa26d0f534d7d327349db0b52bf38fb319709958a01fe518bcb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e821a0092b832a1581c6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01a2504646506f776572436f7265733136363001504646506f776572436f7265733137323001",
  "82825820fd43f693f0cd4c690ca3adde613262fc41530e62b3cacc906a0056603f5514ae0082583901a31261aa26d0f534d7d327349db0b52bf38fb319709958a01fe518bcb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e821a0085b174a1581c6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01a34e4646506f776572436f7265733437014f4646506f776572436f72657336323901504646506f776572436f7265733132343801"
];

// Offer amount in ADA (minimum 5 ADA)
const OFFER_AMOUNT_ADA = 6;

// Step 1: Identify the NFT to bid on
console.log(`NFT to bid on: Policy ID ${NFT_POLICY_ID}, Asset Name ${NFT_ASSET_NAME_HEX}`);

// Step 2: Create the offer payload
const offerPayload = {
  changeAddress: BIDDER_CHANGE_ADDRESS,
  utxos: BIDDER_UTXOS,
  createOffer: [
    {
      policyId: NFT_POLICY_ID,
      assetName: NFT_ASSET_NAME_HEX,
      priceAda: OFFER_AMOUNT_ADA,
    },
  ],
};

console.log(`Creating offer for ${OFFER_AMOUNT_ADA} ADA`);

// Step 3: Build the transaction
const response = await fetch(`${NFT_BASE_URL}/build-tx`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(offerPayload),
});

const result = await response.json();
console.log("Transaction:", result.transactions);

// Next steps: Sign the hex with your wallet and submit via /submit endpoint

// Run this with: deno run --allow-net make-offer.ts

/*

Output:

NFT to bid on: Policy ID 6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01, Asset Name 4646506f776572436f726573373338
Creating offer for 6 ADA
Transaction: [
  "84a900d9010282825820fa7a8f907051db7783be036684481fdce2a5fbcf19f6e5ea5f9f09128288dd1f03825820fd43f693f0cd4c690ca3adde613262fc41530e62b3cacc906a0056603f5514ae0001828358391127d46ecbec94b052d8f875cf3beafd0e8ca40e8ad069f677e0a128eab8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e1a005b8d805820c9f4df9d0e4167f222d78665488e9c2f34e009175cd035e64c34299b40fb61b182583901a31261aa26d0f534d7d327349db0b52bf38fb319709958a01fe518bcb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e821a00b85e35a1581c6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01a54e4646506f776572436f7265733437014f4646506f776572436f72657336323901504646506f776572436f7265733132343801504646506f776572436f7265733136363001504646506f776572436f7265733137323001021a00047df1031a09744f8407582010d70a7bf1ff1ed57b4ac55c6ed323880724390905b3f69b92615166c3ac96990b5820f695042874028762804e62bef426bf89859028ec2374d8efa258a115f1c868bf0dd9010281825820fd43f693f0cd4c690ca3adde613262fc41530e62b3cacc906a0056603f5514ae001082583901a31261aa26d0f534d7d327349db0b52bf38fb319709958a01fe518bcb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e821a00700a34a1581c6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01a34e4646506f776572436f7265733437014f4646506f776572436f72657336323901504646506f776572436f7265733132343801111a0015a740a104d901029fd8799f581cb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1e9fd8799fd8799fd8799f581c5f08a64f580e581735070e1b1d2ce29ae6942ab45ccff5a1747d2283ffd8799fd8799fd8799f581c28f17fdd2d8b8f559ad61e899e31eae90b9e209cbedb1ee8a8c6c7d1ffffffffa140d8799f00a1401a000f4240ffffd8799fd8799fd8799f581ca31261aa26d0f534d7d327349db0b52bf38fb319709958a01fe518bcffd8799fd8799fd8799f581cb8d1658accf78f193c0a78e838a86df10fca5b94b3f538c5fe3bbb1effffffffa1581c6fb0ce0d80bce539333b0b16f4a29a0d40c786249f86850d3a36fa01d8799f00a14f4646506f776572436f72657337333801ffffd8799fd8799fd8799f581c5288ee085dc108f6fdc262b9e0cdfa92663b302836830efc0c5b4fdfffd8799fd8799fd8799f581c41ff84ecc10aae4f3ba8526ba742c739de9d513ace95e17170b1f04cffffffffa140d8799f00a1401a000f4240fffffffffff5a11902a2a1636d7367715761797570205472616e73616374696f6e"
]

*/